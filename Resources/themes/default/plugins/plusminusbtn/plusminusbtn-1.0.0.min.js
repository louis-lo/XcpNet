+function(n){"use strict";var t=function(t,i){this.container=n(t);this.options=n.extend({},{max:9999,min:1,price:0,plus:".jsPlus",num:".jsNumber",minus:".jsMinus",tCount:".jsTotalCount",tMoney:".jsTotalMoney",singleMoney:"jsSingleMoney",onCalc:null,onPlus:null,onMinus:null,onChange:null},i);this.btnMinus=this.container.find(this.options.minus);this.number=this.container.find(this.options.num)[0];this.btnPlus=this.container.find(this.options.plus);this.init()};t.prototype={init:function(){this.btnMinus.click(n.proxy(this.minus,this));this.btnPlus.click(n.proxy(this.plus,this));this.number.onkeyup=this.number.onafterpaste=n.proxy(this.valid,this);var t=n(this.number),i=t.data("max"),r=t.data("min"),u=t.data("price");i>0&&(this.options.max=i);r>0&&(this.options.min=r);u>0&&(this.options.price=u)},minus:function(){this.getNumber()>this.options.min?(this.number.value=parseInt(this.number.value)-1,this.calcTotal(),typeof this.options.onChange=="function"&&this.options.onChange(this)):Cnaws.showInfo("购买数量最少为"+this.options.min+"件！");typeof this.options.onMinus=="function"&&this.options.onMinus(this)},plus:function(){this.getNumber()<this.options.max?(this.number.value=parseInt(this.number.value)+1,this.calcTotal(),typeof this.options.onChange=="function"&&this.options.onChange(this)):Cnaws.showInfo("购买数量不能大于库存数量！");typeof this.options.onPlus=="function"&&this.options.onPlus(this)},valid:function(n){var t=n.target.value,i;t=t.length===1?t.replace(/[^1-9]/g,""):t.replace(/\D/g,"");t===""?t=this.options.min:(i=parseInt(t),t=i>this.options.max?this.options.max:i<this.options.min?this.options.min:t);n.target.value=t;this.calcTotal();typeof this.options.onChange=="function"&&this.options.onChange(this)},getNumber:function(){return parseInt(this.number.value)},calcTotal:function(){var t=this;this.options.singleTotalMoney=(this.getNumber()*this.options.price).toFixed(2);this.options.idArray=[];this.options.countArray=[];this.options.totalCount=0;this.options.totalMomey=0;n(this.options.num).each(function(i,r){var u=n(r),f=parseInt(this.value);t.options.totalCount+=f;t.options.totalMomey+=f*parseFloat(u.data("price"));u.data("id")&&t.options.idArray.push(parseInt(u.data("id")));t.options.countArray.push(f)});this.options.singleMoney!==""&&n(this.options.singleMoney).text("¥"+this.options.singleTotalMoney);this.options.tCount!==""&&n(this.options.tCount).text("¥"+this.options.totalCount);this.options.tMoney!==""&&n(this.options.tMoney).text("¥"+this.options.totalMomey.toFixed(2));typeof this.options.onCalc=="function"&&this.options.onCalc(this)}};n.fn.plusMinusBtn=function(n,i){this.each(function(r){var e=this.dataset.plusminusbtn,f=typeof n=="object"&&n,u;i?u=new t(this,f):e||(u=this.dataset.plusminusbtn=new t(this,f));r==0&&u.calcTotal()})};window.PlusMinusBtn=t}(typeof $!="undefined"&&typeof jQuery!="undefined"?$:Zepto,document);