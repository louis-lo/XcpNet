/*!
 *pc端购物车页面操作脚本
 * Requires jQuery v1.7 or later
 * Created by liu mixoaxin on 2016-07-15
 */
+function(n,t){"use strict";var i=function(t){return n.getElementById(t)},r=function(n){var f={cartInstance:new Cnaws.Cart,totalMoney:i("totalMoney"),btnClear:t("span.clear_cart"),btnSubmit:i("btnSubmit"),btnCancel:i("btnCancel"),btnOk:i("btnOk"),btnClose:i("btnClose"),dels:t("a.js-del"),checks:t('input[name="Id"]'),chkAll:t("#chkAll"),form:i("form")};n=t.extend({},f,n||{});var u=function(){var n=[],i=[],r=[];return t('input:[name="Id"]').each(function(u,f){if(f.checked){n.push(f.getAttribute("data-id"));i.push(f.value);var e=t(f).parents("li").find('input[name="Count"]').val();r.push(e)}}),{cartId:n.join(","),productId:i.join(","),count:r.join(",")}},e=function(n){var t=n.container.prev().find(".pricBig").html().replace("¥","").replace(",",""),i=n.number.value;n.container.next().find(".fb").text("¥"+(parseFloat(t)*i).toFixed(2))},r=function(){var r=t("li.goods_wrap:has(input:[checked])"),u=0,i=0;r.each(function(n,r){var f=t(r),e=f.find(".js-number").val(),o=f.find(".pricBig").text().replace("¥","").replace(",","");u+=e;i+=parseFloat(o)*e});n.totalMoney.innerText="¥"+i.toFixed(2)};t("div.item_number").plusMinusBtn({plus:"span.next",num:".js-number",minus:"span.prev",onChange:function(n){e(n);r()}});t("a.js-del").xalert({tmpl:"确定要删除此商品吗？",callback:function(i){var u=t(i.target).parents("li").find('input[name="Id"]').data("id");n.cartInstance.del(u,function(){u=typeof u!="string"?u.toString().split(","):u.split(",");for(var n=0;n<u.length;n++)t("input:[data-id="+u[n]+"]").parents("li").remove();r();Cnaws.showSuccess("删除成功")});i.close()}});n.btnClear.xalert({tmpl:"确定要清空购物车吗",callback:function(i){var r=u().cartId;r!==""&&n.cartInstance.del(r,function(){t("li.goods_wrap").remove();i.close();n.totalMoney.innerText="¥0.00"})}});n.checks.change(function(){r()});n.chkAll.change(function(){t('.goods_wrap input[name="Id"]').attr("checked",this.checked);r()});n.btnSubmit.onclick=function(i){if(i.preventDefault(),i.stopPropagation(),t("li.goods_wrap:has(input:checked)").length==0)Cnaws.showError("请选择商品！");else{Cnaws.showInfo("正在提交数据，请稍后...");var r=u();n.cartInstance.buy(r.productId,r.count)}}};window.Cart=r}(document,$);